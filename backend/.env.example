# ===================================================================
# BuhBot Backend Environment Configuration - EXAMPLE FILE
# ===================================================================
# IMPORTANT: Copy this file to .env and fill in your actual credentials
# Command: cp .env.example .env
#
# .env is git-ignored and will NOT be committed to the repository

# ===================================================================
# Node Environment
# ===================================================================
NODE_ENV=development
PORT=3000

# ===================================================================
# DEV MODE - Local Development Without Supabase
# ===================================================================
# Enable DEV MODE to bypass Supabase authentication
# This creates a mock admin user for local development
# IMPORTANT: Never enable in production!
# DEV_MODE=true
# DEV_USER_EMAIL=admin@buhbot.local

# ===================================================================
# Supabase Configuration
# ===================================================================
# Get from: Supabase Dashboard > Project Settings

# Supabase Project URL
# Format: https://[PROJECT-REF].supabase.co
SUPABASE_URL=https://PROJECT-REF.supabase.co

# Supabase Service Role Key (for admin operations and JWT validation)
# Get from: Supabase Dashboard > Project Settings > API > service_role key
# SECURITY: Never expose this key to client-side code
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here

# ===================================================================
# Database Configuration (Supabase PostgreSQL)
# ===================================================================
# Get from: Supabase Dashboard > Project Settings > Database > Connection String
#
# DATABASE_URL: Connection pooler URL (for application queries)
# Format: postgresql://postgres.[PROJECT-REF]:[PASSWORD]@aws-0-eu-central-1.pooler.supabase.com:6543/postgres?pgbouncer=true&sslmode=require&connection_limit=10
# IMPORTANT: sslmode=require is REQUIRED for production security (TLS encryption)
# connection_limit=10 matches project constitution pool settings
DATABASE_URL=postgresql://postgres.PROJECT-REF:PASSWORD@aws-0-eu-central-1.pooler.supabase.com:6543/postgres?pgbouncer=true&sslmode=require&connection_limit=10
#
# DIRECT_URL: Direct database URL (for Prisma migrations, bypasses pooler)
# Format: postgresql://postgres:[PASSWORD]@db.PROJECT-REF.supabase.co:5432/postgres
# Optional: Only required when using connection pooler (when DATABASE_URL has pgbouncer=true)
DIRECT_URL=postgresql://postgres:PASSWORD@db.PROJECT-REF.supabase.co:5432/postgres

# ===================================================================
# Redis Configuration (for BullMQ queues)
# ===================================================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# ===================================================================
# Telegram Bot Configuration
# ===================================================================
# Get from: @BotFather on Telegram
# Command: /newbot
TELEGRAM_BOT_TOKEN=your_bot_token_here

# Bot username (without @), used for generating deep links
# Example: top_buhbot (for @top_buhbot)
BOT_USERNAME=your_bot_username

# Webhook URL (your public HTTPS domain)
# Example: https://buhbot.aidevteam.ru
TELEGRAM_WEBHOOK_URL=https://your-domain.com

# Webhook Secret Token for signature validation
# Generate with: openssl rand -hex 32
# This is used to validate incoming webhook requests from Telegram
# Must be passed to setWebhook API call as secret_token parameter
TELEGRAM_WEBHOOK_SECRET=

# ===================================================================
# Logging
# ===================================================================
# Levels: error, warn, info, debug
LOG_LEVEL=info

# ===================================================================
# Security & Encryption
# ===================================================================
# Generate with: openssl rand -base64 32
JWT_SECRET=
ENCRYPTION_KEY=

# ===================================================================
# Circuit Breaker Configuration
# ===================================================================
# Controls when the system stops calling OpenRouter after repeated failures
# Uncomment to override defaults
# CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
# CIRCUIT_BREAKER_SUCCESS_THRESHOLD=2
# CIRCUIT_BREAKER_TIMEOUT_MS=60000

# ===================================================================
# Metrics & Monitoring
# ===================================================================
PROMETHEUS_PORT=9090
ENABLE_METRICS=false
ENABLE_SENTRY=false

# Sentry (optional error tracking)
SENTRY_DSN=

# ===================================================================
# Queue Configuration (all optional - defaults match production requirements)
# ===================================================================
# Global queue defaults
# QUEUE_DEFAULT_ATTEMPTS=3
# QUEUE_DEFAULT_BACKOFF_DELAY=1000
# QUEUE_DEFAULT_REMOVE_ON_COMPLETE=100
# QUEUE_DEFAULT_REMOVE_ON_FAIL=1000

# Alert worker
# QUEUE_ALERT_CONCURRENCY=3
# QUEUE_ALERT_RATE_LIMIT_MAX=30
# QUEUE_ALERT_RATE_LIMIT_DURATION=1000

# SLA timer worker
# QUEUE_SLA_CONCURRENCY=5
# QUEUE_SLA_RATE_LIMIT_MAX=10
# QUEUE_SLA_RATE_LIMIT_DURATION=1000
# QUEUE_SLA_ATTEMPTS=1
# QUEUE_SLA_REMOVE_ON_COMPLETE=50

# Survey worker
# QUEUE_SURVEY_CONCURRENCY=5
# QUEUE_SURVEY_RATE_LIMIT_MAX=30
# QUEUE_SURVEY_RATE_LIMIT_DURATION=1000
# QUEUE_SURVEY_ATTEMPTS=5
# QUEUE_SURVEY_REMINDER_DELAY_DAYS=2
# QUEUE_SURVEY_MANAGER_NOTIFY_DELAY_DAYS=5

# Data retention
# QUEUE_DATA_RETENTION_ATTEMPTS=2
# QUEUE_DATA_RETENTION_BACKOFF_DELAY=5000
# QUEUE_DATA_RETENTION_SCHEDULE=0 0 * * *

# Worker shutdown
# QUEUE_WORKER_SHUTDOWN_TIMEOUT=10000

# ===================================================================
# Notes
# ===================================================================
# - Never commit .env to git
# - Keep your tokens and passwords secure
# - Use environment-specific values for different setups (dev, staging, production)
# - All data must be stored in Yandex Cloud for 152-ФЗ compliance
# - Generate strong secrets with: openssl rand -base64 32

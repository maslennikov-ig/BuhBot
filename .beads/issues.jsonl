{"id":"buh-08n","title":"CR: Fix warning banner false-positive with globalManagerIds (H-3)","description":"Warning banner shows even when globalManagerIds configured. Need to check global managers or update text.","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-26T10:33:34Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T10:45:19Z","closed_at":"2026-02-26T10:45:19Z","close_reason":"CR fixes committed in 778d205"}
{"id":"buh-0i4","title":"gh-209: Restore Previously Deleted Chats","description":"gh-209: Soft-delete for chats. Add deletedAt field to Chat model, convert hard-delete to soft-delete (set timestamp), filter all 22 Chat query locations, add restore mutation + listDeleted query, update 4 upsert locations to clear deletedAt on re-register, frontend RestoreZone + deleted chats toggle. Prisma extension for auto-filtering. ~8 files, 1 migration.","status":"closed","priority":4,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-26T10:04:03Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T11:26:44Z","closed_at":"2026-02-26T11:26:44Z","close_reason":"Soft-delete implemented in commit aa95b19","external_ref":"gh-209"}
{"id":"buh-0kz","title":"Add logger smoke test","description":"Winston logger BigInt fix (commit aa78ca4) showed logging can silently fail. Add backend/src/utils/__tests__/logger.smoke.test.ts to verify logger.info/warn/error don't throw, including BigInt in metadata","status":"closed","priority":3,"issue_type":"chore","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T16:45:32Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T11:06:01Z","closed_at":"2026-02-26T11:06:01Z","close_reason":"Implemented in commit 142461b on chore/misc-improvements"}
{"id":"buh-0rz","title":"CR: Fix SLA-enable validation to check input.managerTelegramIds (M-4)","description":"chats.ts validation reads existingChat.managerTelegramIds instead of input.managerTelegramIds when enabling SLA + setting managers in same request","status":"closed","priority":2,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-26T10:33:34Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T10:45:19Z","closed_at":"2026-02-26T10:45:19Z","close_reason":"CR fixes committed in 778d205"}
{"id":"buh-10e","title":"RC3: Migrate ChatMessage/ClientRequest records on Group→Supergroup migration","description":"chat-event.handler.ts:156-234 — Migration creates new Chat record but historical ChatMessage, ClientRequest, SlaAlert records still reference old chat ID. Add raw SQL or Prisma updateMany to migrate FK references during migration event. Also handle accountantTelegramIds copy. File: backend/src/bot/handlers/chat-event.handler.ts. Ref: gh-185","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T19:35:50Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T19:43:08Z","closed_at":"2026-02-20T19:43:08Z","close_reason":"Migration handler now migrates all FK references + copies accountantTelegramIds and clientTier"}
{"id":"buh-1x2","title":"Process GitHub Issues #172-#182","description":"Batch processing: CI build args (gh-172,173,178), DEV MODE cleanup (gh-175,176,177,179), Telegram validation (gh-181,182), URL config (gh-180), docs (gh-174). Plan: docs/plans/mighty-leaping-karp.md","status":"closed","priority":1,"issue_type":"epic","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:19:17Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:26:57Z","closed_at":"2026-02-20T16:26:57Z","close_reason":"All 11 issues fixed and pushed: gh-172..gh-182"}
{"id":"buh-2dl","title":"S1: Фильтрация disabled/migrated чатов в chats.list","description":"Добавить параметр includeDisabled в input schema и фильтр monitoringEnabled=true по умолчанию в chats.list. Файл: backend/src/api/trpc/routers/chats.ts строки 46-135. gh-185","status":"closed","priority":2,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-21T10:13:39Z","created_by":"Igor Maslennikov","updated_at":"2026-02-21T10:16:38Z","closed_at":"2026-02-21T10:16:38Z","close_reason":"Добавлен параметр includeDisabled и фильтр monitoringEnabled=true по умолчанию"}
{"id":"buh-2fc","title":"Fix rate limiting description in roadmap","description":"Roadmap describes rate limiting as 'Redis sliding window, ZADD before ZCARD' for all layers. Reality: Bot middleware uses Redis ZSET (correct), Express middleware uses in-memory Map, Telegram link auth uses in-memory Map, Nginx uses limit_req_zone. Fix Section 2.3 rate limiting table and Defense in Depth table in docs/SECURE-BY-DESIGN-ROADMAP.md","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T16:45:29Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T16:46:21Z","closed_at":"2026-02-22T16:46:21Z","close_reason":"Fixed rate limiting table and Defense in Depth description to accurately reflect multi-layer implementation"}
{"id":"buh-2hf","title":"Consolidate two security assessment documents","description":"SECURITY-ASSESSMENT.md (365 lines) and SECURITY-ASSESSMENT-FULL.md (680 lines) duplicate ~60% content. Delete SECURITY-ASSESSMENT.md, rename SECURITY-ASSESSMENT-FULL.md to SECURITY-ASSESSMENT.md, update references in roadmap","status":"closed","priority":2,"issue_type":"chore","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T16:45:30Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T16:55:09Z","closed_at":"2026-02-22T16:55:09Z","close_reason":"Consolidated two assessment docs into one, added Quick Summary, fixed self-reference, updated roadmap links"}
{"id":"buh-2qm","title":"gh-184: Fix BigInt conversion gaps in tRPC routers","description":"chats.getById (line 172), chats.update (lines 365, 513) pass input.id without BigInt(). requests.list (line 117) passes chatId without BigInt(). alerts.listUnacknowledged (line 88) uses Number() instead of safeNumberFromBigInt(). requests.getThread (line 643) uses Number() instead of safeNumberFromBigInt().","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-21T06:12:36Z","created_by":"Igor Maslennikov","updated_at":"2026-02-21T06:13:59Z","closed_at":"2026-02-21T06:13:59Z","close_reason":"Fixed: BigInt conversions in chats/requests/alerts routers + disabled RLS on error_logs"}
{"id":"buh-2wf","title":"gh-186: Disable RLS on error_logs table","description":"RLS policies on error_logs require auth.uid() which returns NULL for backend pg.Pool connections. All INSERT blocked since 2026-01-16. Fix: new migration to drop policies and disable RLS.","status":"closed","priority":0,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-21T06:12:36Z","created_by":"Igor Maslennikov","updated_at":"2026-02-21T06:13:59Z","closed_at":"2026-02-21T06:13:59Z","close_reason":"Fixed: BigInt conversions in chats/requests/alerts routers + disabled RLS on error_logs"}
{"id":"buh-2zr","title":"CR: DRY — centralize getManagerIds in 3 services (H-1, H-2, M-1)","description":"Refactor alert.service.ts, sla-timer.worker.ts, feedback/alert.service.ts to delegate to config.service.ts:getManagerIds() instead of duplicating resolution chain","status":"closed","priority":1,"issue_type":"chore","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-26T10:33:33Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T10:45:19Z","closed_at":"2026-02-26T10:45:19Z","close_reason":"CR fixes committed in 778d205"}
{"id":"buh-355","title":"gh-180: Centralize hardcoded production URLs","description":"Hardcoded https://buhbot.aidevteam.ru in auth.ts:286 and index.ts:44 CORS. Fix: use env.FRONTEND_URL instead. Files: backend/src/api/trpc/routers/auth.ts, backend/src/index.ts","status":"closed","priority":3,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:20:00Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:23:30Z","closed_at":"2026-02-20T16:23:30Z","close_reason":"Closed","external_ref":"gh-180"}
{"id":"buh-48l","title":"S2: Add observer role filtering to chats.list","description":"chats.ts:74-82 — chats.list has no role-based filter. Observers see all chats but get FORBIDDEN on access. Add: if (user.role === 'observer') where.assignedAccountantId = user.id. File: backend/src/api/trpc/routers/chats.ts. Ref: gh-185","status":"closed","priority":3,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T19:35:54Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T19:43:09Z","closed_at":"2026-02-20T19:43:09Z","close_reason":"Observer role filter added to chats.list where clause"}
{"id":"buh-49m","title":"M-4: Add DEV_MODE guard to createUser in auth.ts","description":"Code review finding M-4. backend/src/api/trpc/routers/auth.ts createUser makes real Supabase call in DEV_MODE. Fix: add isDevMode early return with error message.","status":"closed","priority":2,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:40:08Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:41:10Z","closed_at":"2026-02-20T16:41:10Z","close_reason":"Closed"}
{"id":"buh-4el","title":"Diagnose chat -1003476024757 messages issue","description":"Run SQL queries on production DB to determine root cause: check if messages exist, check chat record state, check server logs. Hypothesis A: bot not receiving messages. Hypothesis B: messages stored but query doesn't return them.","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-24T16:41:23Z","created_by":"Igor Maslennikov","updated_at":"2026-02-24T16:42:15Z","closed_at":"2026-02-24T16:42:15Z","close_reason":"Confirmed Hypothesis A: message_count=0, chat registered ok, bot not receiving regular messages due to Privacy Mode ON + not admin in supergroup"}
{"id":"buh-5av","title":"gh-175: Remove dead X-Dev-Mode header from frontend","description":"Frontend sends X-Dev-Mode header but backend never reads it. Dead code. Fix: remove 'X-Dev-Mode': 'true' line from frontend/src/lib/trpc.ts:63","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:19:52Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:23:30Z","closed_at":"2026-02-20T16:23:30Z","close_reason":"Closed","external_ref":"gh-175"}
{"id":"buh-5bk","title":"RC2: FAQ handler must log messages before returning","description":"faq.handler.ts:113-114 — FAQ handler returns without next(), message never reaches message.handler and is never logged to ChatMessage. Fix: call next() after FAQ reply so message.handler logs it, but skip SLA classification via ctx.state flag or similar. File: backend/src/bot/handlers/faq.handler.ts + message.handler.ts. Ref: gh-185","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T19:35:49Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T19:43:08Z","closed_at":"2026-02-20T19:43:08Z","close_reason":"FAQ handler now calls next() with faqHandled flag, messages logged to ChatMessage"}
{"id":"buh-5f4","title":"Make empty OpenRouter response retryable","description":"Empty response from OpenRouter (choices[0].message.content is null) is not retried because isRetryableError() only checks typed OpenAI SDK errors. Add EmptyResponseError class and include it in isRetryableError() check. File: backend/src/services/classifier/openrouter-client.ts","status":"closed","priority":2,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-21T12:38:32Z","created_by":"Igor Maslennikov","updated_at":"2026-02-21T12:41:04Z","closed_at":"2026-02-21T12:41:04Z","close_reason":"Implemented EmptyResponseError class, added to isRetryableError(), replaced throw new Error with throw new EmptyResponseError. Backend type-check passes."}
{"id":"buh-5sz","title":"Add startup Privacy Mode log warning","description":"On bot startup, call getMe() and log warning if can_read_all_group_messages is false. Surfaces the issue in production logs immediately.","status":"closed","priority":3,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-24T16:41:26Z","created_by":"Igor Maslennikov","updated_at":"2026-02-24T16:50:18Z","closed_at":"2026-02-24T16:50:18Z","close_reason":"Implemented and verified"}
{"id":"buh-5xx","title":"P2: Добавить isMigrated поле в Chat модель","description":"P2-1: monitoringEnabled перегружен семантически. Нужен отдельный флаг isMigrated в Prisma schema + миграция + обновить фильтры. Отложить — требует schema change.","status":"closed","priority":3,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-21T10:56:24Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T11:06:01Z","closed_at":"2026-02-26T11:06:01Z","close_reason":"Implemented in commit 142461b on chore/misc-improvements"}
{"id":"buh-60u","title":"Утилита replyAndLog для логирования исходящих сообщений бота","description":"Новый файл: backend/src/bot/utils/log-outgoing.ts. Обёртка replyAndLog(ctx, text, extra): вызывает ctx.reply(), затем логирует ответ бота в ChatMessage с isBotOutgoing: true, telegramDate из sent.date. Мигрировать faq.handler.ts и file.handler.ts на эту утилиту.","status":"closed","priority":2,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T15:04:53Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T15:20:01Z","closed_at":"2026-02-22T15:20:01Z","close_reason":"Реализовано и верифицировано: все type-check проходят","dependencies":[{"issue_id":"buh-60u","depends_on_id":"buh-7dm","type":"blocks","created_at":"2026-02-22T18:05:01Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-6hy","title":"CR-6/7/9: extract shared bot-info cache + privacy warning message","description":"P2: cache getMe(), extract privacyModeWarning() to shared module, guard username undefined","status":"closed","priority":2,"issue_type":"chore","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-24T18:43:38Z","created_by":"Igor Maslennikov","updated_at":"2026-02-24T18:52:15Z","closed_at":"2026-02-24T18:52:15Z","close_reason":"All CR findings fixed in commit 62e4a4b"}
{"id":"buh-6rj","title":"Add bot admin check after /connect and fix Number(chatId) precision","description":"After /connect success reply, check if bot can read all group messages. If Privacy Mode ON and bot not admin, warn user in Russian. Also fix Number(chatId) to chatId.toString() on line 209 for precision safety.","status":"closed","priority":2,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-24T16:41:30Z","created_by":"Igor Maslennikov","updated_at":"2026-02-24T16:50:18Z","closed_at":"2026-02-24T16:50:18Z","close_reason":"Implemented and verified"}
{"id":"buh-7dm","title":"Миграция схемы ChatMessage: telegramDate, editVersion, media-поля","description":"Добавить новые колонки в chat_messages: telegram_date (TIMESTAMPTZ NOT NULL), edit_version (INT DEFAULT 0), message_type (VARCHAR(20) DEFAULT 'text'), media_file_id, media_file_name, caption, is_bot_outgoing, deleted_at. Заменить unique constraint (chat_id, message_id) на (chat_id, message_id, edit_version). Backfill telegram_date = created_at. Новые индексы. Файлы: backend/prisma/schema.prisma:685-713, новая миграция.","status":"closed","priority":0,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T15:04:50Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T15:07:52Z","closed_at":"2026-02-22T15:07:52Z","close_reason":"Схема обновлена: новые поля, unique constraint, индексы. Prisma client сгенерирован."}
{"id":"buh-87x","title":"gh-210: SLA Notification System Not Recognizing Configured Managers (parent tracking)","description":"Parent tracking issue. Done when children (#211, #212, #213) are all fixed.\nScore: 24 (sev=7, imp=7, lkh=10)","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-26T10:03:42Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T10:14:44Z","closed_at":"2026-02-26T10:14:44Z","close_reason":"Fixed: All child issues resolved (#211, #212, #213)","external_ref":"gh-210","dependencies":[{"issue_id":"buh-87x","depends_on_id":"buh-acz","type":"blocks","created_at":"2026-02-26T13:03:50Z","created_by":"Igor Maslennikov","metadata":"{}"},{"issue_id":"buh-87x","depends_on_id":"buh-i01","type":"blocks","created_at":"2026-02-26T13:03:51Z","created_by":"Igor Maslennikov","metadata":"{}"},{"issue_id":"buh-87x","depends_on_id":"buh-lz6","type":"blocks","created_at":"2026-02-26T13:03:49Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-8fm","title":"S1: Filter disabled/migrated chats from chats.list or add visual indicator","description":"chats.ts:46-128 — chats.list returns ALL chats including monitoringEnabled=false and [MIGRATED]. Add default filter or badge. File: backend/src/api/trpc/routers/chats.ts + frontend ChatsListContent.tsx. Ref: gh-185","status":"closed","priority":2,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T19:35:52Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T19:43:08Z","closed_at":"2026-02-20T19:43:08Z","close_reason":"monitoringEnabled exposed in chats.list API, frontend shows inactive badge","dependencies":[{"issue_id":"buh-8fm","depends_on_id":"buh-10e","type":"blocks","created_at":"2026-02-20T22:36:01Z","created_by":"Igor Maslennikov","metadata":"{}"},{"issue_id":"buh-8fm","depends_on_id":"buh-z5d","type":"blocks","created_at":"2026-02-20T22:36:01Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-9fw","title":"CR-1/3/13: /diagnose security + verdict logic fix","description":"P0: restrict /diagnose to group admins. P1: fix verdict for 'group' type. P3: fix private chat guard.","status":"closed","priority":0,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-24T18:43:38Z","created_by":"Igor Maslennikov","updated_at":"2026-02-24T18:52:15Z","closed_at":"2026-02-24T18:52:15Z","close_reason":"All CR findings fixed in commit 62e4a4b"}
{"id":"buh-9g1","title":"P0: Интерактивная транзакция миграции + unique conflicts","description":"P0-1: TOCTOU — перевести на interactive tx с SELECT FOR UPDATE. P0-2: Обработать unique constraints (SurveyDelivery @@unique surveyId+chatId, WorkingSchedule @@unique chatId+dayOfWeek). P1-2: timeout 30000. P2-3: Добавить ChatInvitation.createdChatId в миграцию. P3-2: inviteLink в update branch. P4-3: Детальный error log. Файл: backend/src/bot/handlers/chat-event.handler.ts","status":"closed","priority":0,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-21T10:56:23Z","created_by":"Igor Maslennikov","updated_at":"2026-02-21T11:04:23Z","closed_at":"2026-02-21T11:04:23Z","close_reason":"Interactive transaction + unique conflict resolution + timeout + ChatInvitation + inviteLink + error log"}
{"id":"buh-a97","title":"Заменить upsert на createMany (append-only) в message.handler.ts","description":"Файл: backend/src/bot/handlers/message.handler.ts:152-176. Заменить prisma.chatMessage.upsert() на prisma.chatMessage.createMany({ data: [...], skipDuplicates: true }). Добавить telegramDate: new Date(ctx.message.date * 1000). editVersion: 0 для оригиналов. ON CONFLICT DO NOTHING вместо UPDATE.","status":"closed","priority":0,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T15:04:50Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T15:08:56Z","closed_at":"2026-02-22T15:08:56Z","close_reason":"Код обновлён: append-only insert, editVersion filter, triple-unique migration","dependencies":[{"issue_id":"buh-a97","depends_on_id":"buh-7dm","type":"blocks","created_at":"2026-02-22T18:04:59Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-acz","title":"gh-211: UI — Add managerTelegramIds field to ChatSettingsForm","description":"1. Backend: Add managerTelegramIds to chats.update input schema (chats.ts:324)\n2. Frontend ChatSettingsForm.tsx: Add accountantTelegramIds to props, add managerTelegramIds to form schema/defaults/initialData, add comma-separated input field\n3. Fix warning banner (line 222) — hide when accountantTelegramIds populated\n4. Update ChatDetailsContent.tsx to pass new props\nScore: 22 (sev=5, imp=7, lkh=10)","status":"closed","priority":1,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-26T10:03:41Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T10:14:43Z","closed_at":"2026-02-26T10:14:43Z","close_reason":"Fixed: Added managerTelegramIds field to ChatSettingsForm + accountantTelegramIds warning fix","external_ref":"gh-211","dependencies":[{"issue_id":"buh-acz","depends_on_id":"buh-lxu","type":"blocks","created_at":"2026-02-26T13:03:49Z","created_by":"Igor Maslennikov","metadata":"{}"},{"issue_id":"buh-acz","depends_on_id":"buh-lz6","type":"blocks","created_at":"2026-02-26T13:03:48Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-ano","title":"Add proactive Privacy Mode warning in chat-event handler","description":"When bot is added to a group as regular member (not admin) and Privacy Mode is ON, send a warning about needing admin rights. Non-blocking, wrapped in try/catch.","status":"closed","priority":2,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-24T16:41:25Z","created_by":"Igor Maslennikov","updated_at":"2026-02-24T16:50:18Z","closed_at":"2026-02-24T16:50:18Z","close_reason":"Implemented and verified"}
{"id":"buh-azz","title":"gh-176: Fix inconsistent mock user IDs","description":"supabase.ts uses 11111111-..., config.ts and backend use aaaaaaaa-.... Fix: change supabase.ts:21 mock ID to aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:19:55Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:23:30Z","closed_at":"2026-02-20T16:23:30Z","close_reason":"Closed","external_ref":"gh-176","dependencies":[{"issue_id":"buh-azz","depends_on_id":"buh-kgf","type":"blocks","created_at":"2026-02-20T19:20:08Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-b1r","title":"CR-2/4/5/10/12: minor text and env fixes","description":"P1: use env module for BOT_USERNAME, fix supergroup→group text, fix comments, improve error msg","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-24T18:43:40Z","created_by":"Igor Maslennikov","updated_at":"2026-02-24T18:52:16Z","closed_at":"2026-02-24T18:52:16Z","close_reason":"All CR findings fixed in commit 62e4a4b"}
{"id":"buh-bah","title":"CR: Update warning banner text to mention accountants (L-1)","description":"Update warning text to mention assigning accountants via @username as resolution path","status":"closed","priority":3,"issue_type":"chore","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-26T10:33:35Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T10:45:19Z","closed_at":"2026-02-26T10:45:19Z","close_reason":"CR fixes committed in 778d205"}
{"id":"buh-bnr","title":"Переключить пагинацию messages.ts на telegramDate + расширить output","description":"Файл: backend/src/api/trpc/routers/messages.ts:59-174. Курсор: createdAt -\u003e telegramDate. Фильтр: deletedAt: null. Расширить output Zod schema: telegramDate, editVersion, messageType, caption, isBotOutgoing. orderBy: telegramDate DESC. Добавить DISTINCT ON для latest version (Phase 2). Фильтр editVersion: показывать только max version.","status":"closed","priority":0,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T15:04:50Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T15:20:01Z","closed_at":"2026-02-22T15:20:01Z","close_reason":"Реализовано и верифицировано: все type-check проходят","dependencies":[{"issue_id":"buh-bnr","depends_on_id":"buh-7dm","type":"blocks","created_at":"2026-02-22T18:04:59Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-cb1","title":"P2-4+P2-5+P2-6+P3-4: Quick cosmetic fixes","description":"P2-4: Перенумеровать шаги в message.handler.ts (5→7 пропущен 6). P2-5: formatTimestamp в file.handler использует new Date() вместо telegramDate. P2-6: Удалить неиспользуемый @@index([createdAt]). P3-4: Убрать лишний fallback telegramDate ?? createdAt на фронтенде.","status":"closed","priority":2,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T17:18:32Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T17:20:49Z","closed_at":"2026-02-22T17:20:49Z","close_reason":"Fixed: step numbering, formatTimestamp, removed unused indexes, removed fallback","dependencies":[{"issue_id":"buh-cb1","depends_on_id":"buh-pm6","type":"blocks","created_at":"2026-02-22T20:18:39Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-cg7","title":"gh-181+182: Add timeout and error differentiation to Telegram validation","description":"validateBotToken() has no timeout and returns generic error. Fix: add AbortSignal.timeout(10_000), differentiate TimeoutError/ENOTFOUND/generic in catch. File: backend/src/services/telegram/validation.ts","status":"closed","priority":2,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:19:59Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:23:30Z","closed_at":"2026-02-20T16:23:30Z","close_reason":"Closed","external_ref":"gh-181"}
{"id":"buh-cl0","title":"M-3: Replace console.error with logger in validation.ts","description":"Code review finding M-3. backend/src/services/telegram/validation.ts:49 uses console.error instead of Winston logger. Fix: import logger, replace console.error with logger.error.","status":"closed","priority":2,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:40:05Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:41:10Z","closed_at":"2026-02-20T16:41:10Z","close_reason":"Closed"}
{"id":"buh-ct0","title":"Обновить response.handler.ts: фильтр editVersion:0 для resolvedRequestId","description":"Файл: backend/src/bot/handlers/response.handler.ts:376-384. updateMany для resolvedRequestId -- добавить фильтр editVersion: 0, чтобы всегда целить в оригинальную версию сообщения, не в редакцию.","status":"closed","priority":1,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T15:04:51Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T15:08:56Z","closed_at":"2026-02-22T15:08:56Z","close_reason":"Код обновлён: append-only insert, editVersion filter, triple-unique migration","dependencies":[{"issue_id":"buh-ct0","depends_on_id":"buh-7dm","type":"blocks","created_at":"2026-02-22T18:05:00Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-cyg","title":"CR: Add missing test cases for warning banner (M-5)","description":"Add test for accountantTelegramIds suppression and live formManagerIds typing suppression","status":"closed","priority":2,"issue_type":"chore","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-26T10:33:35Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T10:45:19Z","closed_at":"2026-02-26T10:45:19Z","close_reason":"CR fixes committed in 778d205"}
{"id":"buh-d72","title":"P2-P3: Типизация ctx.state + консистентность next()","description":"P3-3: Расширить BotContext типом faqHandled в state. P2-2: Унифицировать return/return next() в message.handler. Файлы: bot/index.ts или types, faq.handler.ts, message.handler.ts","status":"closed","priority":2,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-21T10:56:24Z","created_by":"Igor Maslennikov","updated_at":"2026-02-21T11:04:24Z","closed_at":"2026-02-21T11:04:24Z","close_reason":"BotState типизация + consistent return next()"}
{"id":"buh-dme","title":"gh-172: Add NEXT_PUBLIC_BOT_NAME to CI build args","description":"P0 Production Blocker. NEXT_PUBLIC_BOT_NAME missing from .github/workflows/ci.yml frontend build-args. Settings page shows error. Fix: add build-arg line. File: .github/workflows/ci.yml:177-179","status":"closed","priority":0,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:19:49Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:23:30Z","closed_at":"2026-02-20T16:23:30Z","close_reason":"Closed","external_ref":"gh-172"}
{"id":"buh-dyv","title":"Логирование нетекстовых сообщений в file.handler.ts","description":"Файл: backend/src/bot/handlers/file.handler.ts. Добавить createMany в ChatMessage ПЕРЕД отправкой подтверждения. Заполнять messageType (document/photo), mediaFileId, mediaFileName, caption.","status":"closed","priority":2,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T15:04:52Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T15:20:01Z","closed_at":"2026-02-22T15:20:01Z","close_reason":"Реализовано и верифицировано: все type-check проходят","dependencies":[{"issue_id":"buh-dyv","depends_on_id":"buh-7dm","type":"blocks","created_at":"2026-02-22T18:05:00Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-e6y","title":"gh-206: Admin Telegram ID Management","description":"gh-206: Admin Telegram ID Management. Backend mutation setUserTelegramId in auth.ts (adminProcedure), uniqueness check vs TelegramAccount + User. Frontend: UserTelegramDialog.tsx modal, UserList.tsx clickable TG column, page.tsx wiring. Implemented by subagent, verified.","status":"closed","priority":2,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-26T10:04:01Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T11:06:01Z","closed_at":"2026-02-26T11:06:01Z","close_reason":"Implemented in commit 142461b on chore/misc-improvements","external_ref":"gh-206"}
{"id":"buh-egl","title":"P1: Ограничить includeDisabled для admin/manager","description":"P1-1: В chats.list игнорировать includeDisabled если роль не admin/manager. Файл: backend/src/api/trpc/routers/chats.ts строки 91-94","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-21T10:56:24Z","created_by":"Igor Maslennikov","updated_at":"2026-02-21T11:04:24Z","closed_at":"2026-02-21T11:04:24Z","close_reason":"includeDisabled restricted to admin/manager"}
{"id":"buh-er1","title":"gh-173: Add NEXT_PUBLIC_API_URL to CI build args + Dockerfile","description":"NEXT_PUBLIC_API_URL missing from ci.yml and frontend/Dockerfile. SSR falls back to localhost. Fix: add build-arg to ci.yml + ARG/ENV to Dockerfile + arg to docker-compose.yml. Files: .github/workflows/ci.yml, frontend/Dockerfile, infrastructure/docker-compose.yml","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:19:51Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:23:30Z","closed_at":"2026-02-20T16:23:30Z","close_reason":"Closed","external_ref":"gh-173"}
{"id":"buh-fhp","title":"P1-2+P2-2: Fix pagination cursor + DISTINCT ON deleted_at","description":"1) Cursor по telegramDate теряет сообщения с одинаковым timestamp (секундная точность). Использовать составной cursor (telegramDate, id). 2) deleted_at фильтр до DISTINCT ON непоследовательен — перенести в outer WHERE.","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T17:18:20Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T17:33:26Z","closed_at":"2026-02-22T17:33:26Z","close_reason":"Compound cursor (telegramDate, id), moved deleted_at to outer WHERE","dependencies":[{"issue_id":"buh-fhp","depends_on_id":"buh-pm6","type":"blocks","created_at":"2026-02-22T20:18:38Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-g2t","title":"fix(backend): preserve Winston Symbol keys in bigIntFormat","description":"bigIntFormat в Winston logger создает новый объект через Object.entries(), теряя Symbol-ключи (Symbol.for('level'), Symbol.for('message')). Это приводит к тому что ВСЕ лог-записи молча отбрасываются. Нужно мутировать info in-place вместо создания нового объекта.","status":"closed","priority":0,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-21T12:06:38Z","created_by":"Igor Maslennikov","updated_at":"2026-02-21T12:10:32Z","closed_at":"2026-02-21T12:10:32Z","close_reason":"Fix committed and pushed: aa78ca4. bigIntFormat now mutates info in-place, preserving Winston Symbol keys."}
{"id":"buh-h07","title":"RC3: Обернуть миграцию Group→Supergroup в $transaction","description":"Заменить Promise.all на prisma.$transaction в chat-event.handler.ts для атомарности миграции записей (ChatMessage, ClientRequest, WorkingSchedule, FeedbackResponse, SurveyDelivery, ChatHoliday). Файл: backend/src/bot/handlers/chat-event.handler.ts строки 173-276. gh-185","status":"closed","priority":2,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-21T10:13:39Z","created_by":"Igor Maslennikov","updated_at":"2026-02-21T10:16:38Z","closed_at":"2026-02-21T10:16:38Z","close_reason":"Миграция обёрнута в prisma.$transaction — все 8 операций атомарны"}
{"id":"buh-h7d","title":"Switch to feature branch + PR workflow","description":"Fix CI concurrency cancellation cascade, rewrite /push command for PR workflow, update CLAUDE.md and speckit.implement.md, apply branch protection","status":"closed","priority":1,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-21T13:54:42Z","created_by":"Igor Maslennikov","updated_at":"2026-02-21T13:56:50Z","closed_at":"2026-02-21T13:56:50Z","close_reason":"PR #194 created. CI concurrency fixed, /push rewritten, CLAUDE.md updated. Branch protection to apply after merge."}
{"id":"buh-i01","title":"gh-213: UI — Add globalManagerIds field to Global Settings page","description":"1. Create SlaManagerSettingsForm.tsx (pattern: NotificationSettingsForm.tsx)\n2. Add to settings-page-content.tsx under SLA section\n3. Uses settings.updateGlobalSettings({ globalManagerIds }) — backend already supports\nScore: 22 (sev=5, imp=7, lkh=10)","status":"closed","priority":1,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-26T10:03:42Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T10:14:43Z","closed_at":"2026-02-26T10:14:43Z","close_reason":"Fixed: Created SlaManagerSettingsForm component + added to settings page","external_ref":"gh-213","dependencies":[{"issue_id":"buh-i01","depends_on_id":"buh-lxu","type":"blocks","created_at":"2026-02-26T13:03:50Z","created_by":"Igor Maslennikov","metadata":"{}"},{"issue_id":"buh-i01","depends_on_id":"buh-lz6","type":"blocks","created_at":"2026-02-26T13:03:48Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-j08","title":"gh-207: Dashboard Alerts for Missing Telegram IDs","description":"Alert admins when chats have no Telegram IDs. Needs dedup key design. Depends on SLA cluster.","status":"closed","priority":3,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-26T10:04:02Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T11:06:01Z","closed_at":"2026-02-26T11:06:01Z","close_reason":"Implemented in commit 142461b on chore/misc-improvements","external_ref":"gh-207"}
{"id":"buh-j27","title":"P2-1+P2-7: Extract logMediaMessage + fix N+1 in chat-event","description":"1) file.handler.ts: дублирование createMany для document и photo — вынести в logMediaMessage helper. 2) chat-event.handler.ts: N+1 при миграции сообщений — заменить цикл deleteMany на один raw SQL DELETE WHERE (message_id, edit_version) IN (SELECT...).","status":"closed","priority":2,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T17:18:31Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T17:33:27Z","closed_at":"2026-02-22T17:33:27Z","close_reason":"Extracted logMediaMessage helper, replaced N+1 loop with single raw SQL DELETE","dependencies":[{"issue_id":"buh-j27","depends_on_id":"buh-pm6","type":"blocks","created_at":"2026-02-22T20:18:38Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-j84","title":"gh-190: Enhance error_logs access control and metadata sanitization","description":"Two security enhancements: 1) Elevate read auth from authedProcedure to managerProcedure for error logs. 2) Add recursive metadata sanitization to strip sensitive fields before DB storage.","status":"closed","priority":2,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-21T11:32:20Z","created_by":"Igor Maslennikov","updated_at":"2026-02-21T11:37:54Z","closed_at":"2026-02-21T11:37:54Z","close_reason":"Implemented: 1) Elevated read auth to managerProcedure, 2) Added recursive metadata sanitization. Commits: a45e4da, d618eab","external_ref":"gh-190"}
{"id":"buh-kgf","title":"gh-177: Unify isDevMode exports to single source","description":"Two different isDevMode exports: config.ts (explicit NEXT_PUBLIC_DEV_MODE=true) and supabase.ts (auto when no Supabase). Fix: remove export from supabase.ts, rename to isDevModeLocal, update SetPasswordForm.tsx and ProfileMenu.tsx imports to use @/lib/config","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:19:53Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:23:30Z","closed_at":"2026-02-20T16:23:30Z","close_reason":"Closed","external_ref":"gh-177"}
{"id":"buh-kwi","title":"[Epic] Append-only message store: Telegram как источник правды","description":"Веб-панель показывает сообщения, не совпадающие с Telegram-чатом. Требуется: 1) timestamp из Telegram вместо DB now(), 2) insert вместо upsert (append-only), 3) обработка edited_message, 4) логирование медиа и исходящих бота, 5) polling на фронте. План: docs/plans/linear-booping-candle.md","status":"closed","priority":0,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T15:04:25Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T15:20:06Z","closed_at":"2026-02-22T15:20:06Z","close_reason":"Все 9 подзадач выполнены: миграция схемы, append-only insert, pagination по telegramDate, edit handler, file logging, replyAndLog, frontend polling + UI"}
{"id":"buh-l0d","title":"P3-1+P3-3+P2-3: Frontend UX improvements","description":"P3-1: Разные иконки для бухгалтера и бота. P3-3: Заменить мутацию let currentDate на useMemo группировку. P2-3: Добавить key={chatId} для сброса polling при смене чата.","status":"closed","priority":3,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T17:18:32Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T17:33:27Z","closed_at":"2026-02-22T17:33:27Z","close_reason":"Briefcase icon for accountant, useMemo grouping, key={chatId} docs","dependencies":[{"issue_id":"buh-l0d","depends_on_id":"buh-pm6","type":"blocks","created_at":"2026-02-22T20:18:39Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-lba","title":"P1-1+P1-5: file.handler group guard + shared validation schema","description":"1) file.handler.ts: chatId может быть undefined для личных сообщений — добавить guard if (\\!ctx.chat || \\!['group','supergroup'].includes(ctx.chat.type)) return. Для document и photo блоков. 2) edit.handler.ts не валидирует текст как message.handler. Вынести TelegramMessageSchema в backend/src/bot/utils/telegram-schemas.ts и использовать в обоих.","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T17:18:20Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T17:33:26Z","closed_at":"2026-02-22T17:33:26Z","close_reason":"Added group guard in file.handler, shared TelegramMessageSchema, validation in edit.handler","dependencies":[{"issue_id":"buh-lba","depends_on_id":"buh-pm6","type":"blocks","created_at":"2026-02-22T20:18:37Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-ley","title":"CR-8/14: shared startup config for webhook and polling","description":"P2: extract configureBotDefaults() + BOT_COMMANDS constant for both modes","status":"closed","priority":2,"issue_type":"chore","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-24T18:43:39Z","created_by":"Igor Maslennikov","updated_at":"2026-02-24T18:52:15Z","closed_at":"2026-02-24T18:52:15Z","close_reason":"All CR findings fixed in commit 62e4a4b"}
{"id":"buh-lxu","title":"gh-212: Backend — Add accountantTelegramIds fallback in notification resolution chain","description":"Fix 5 locations where notification recipients are resolved:\n1. config.service.ts:202 — getManagerIds() — add accountantTelegramIds param\n2. alert.service.ts:496 — getManagerIdsForChat() — select+check accountantTelegramIds\n3. sla-timer.worker.ts:155 — inline resolution — add accountant fallback step\n4. escalation.service.ts:48 — getManagerIdsForChat() — pass accountantTelegramIds\n5. feedback/alert.service.ts:181 — getManagerIds() — add accountantTelegramIds param\n6. chats.ts:383 — SLA-enable validation — check accountantTelegramIds\n\nCorrect chain: managerTelegramIds \u003e accountantTelegramIds \u003e globalManagerIds \u003e []\nType: accountantTelegramIds is BigInt[], convert via .toString()\nScore: 21 (sev=7, imp=7, lkh=7)","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-26T10:03:41Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T10:14:42Z","closed_at":"2026-02-26T10:14:42Z","close_reason":"Fixed: Added accountantTelegramIds fallback in 5 backend locations + validation in chats.ts","external_ref":"gh-212","dependencies":[{"issue_id":"buh-lxu","depends_on_id":"buh-lz6","type":"blocks","created_at":"2026-02-26T13:03:47Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-lz6","title":"Process GitHub Issues: SLA Notification Cluster #210-213","description":"Batch processing: fix SLA notification system that ignores accountantTelegramIds. 4 child issues: #212 backend fallback, #211 chat UI, #213 global settings UI, #210 parent tracking.","status":"closed","priority":1,"issue_type":"epic","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-26T10:03:23Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T10:14:44Z","closed_at":"2026-02-26T10:14:44Z","close_reason":"Epic complete: SLA Notification Cluster #210-213 fully resolved"}
{"id":"buh-n8k","title":"Fix webhook signature code snippet in roadmap","description":"Section 2.3 shows HMAC-SHA256 computation but actual implementation (middleware/telegram-signature.ts) does direct constant-time string comparison of X-Telegram-Bot-Api-Secret-Token header. No HMAC involved. Fix the code snippet and table entry in docs/SECURE-BY-DESIGN-ROADMAP.md","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T16:45:30Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T16:46:22Z","closed_at":"2026-02-22T16:46:22Z","close_reason":"Replaced HMAC-SHA256 snippet with actual safeCompare implementation, added webhook auth to components table"}
{"id":"buh-nli","title":"P0-2: Atomic INSERT...SELECT in edit.handler.ts","description":"Race condition: findFirst + createMany без транзакции. При параллельной доставке edited_message оба читают editVersion=N и вставляют N+1, второй skipDuplicates молча теряет правку. Заменить на атомарный INSERT...SELECT MAX(edit_version)+1 с ON CONFLICT DO NOTHING через prisma.$executeRaw.","status":"closed","priority":0,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T17:18:17Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T17:33:25Z","closed_at":"2026-02-22T17:33:25Z","close_reason":"Replaced read-modify-insert with atomic INSERT...SELECT MAX(edit_version)+1 ON CONFLICT DO NOTHING","dependencies":[{"issue_id":"buh-nli","depends_on_id":"buh-pm6","type":"blocks","created_at":"2026-02-22T20:18:36Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-npv","title":"M-2: Use env var for OpenGraph URL in page.tsx","description":"frontend/src/app/page.tsx:30 has hardcoded buhbot.aidevteam.ru in metadata. Fix: use process.env.NEXT_PUBLIC_SITE_URL with current domain as fallback.","status":"closed","priority":3,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:45:44Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:46:44Z","closed_at":"2026-02-20T16:46:44Z","close_reason":"Closed"}
{"id":"buh-nv3","title":"Trim roadmap to realistic project scale","description":"873-line roadmap contains enterprise content (ISO 27001, bug bounty, LMS training, RACI matrices, security champion programs) inappropriate for 1-2 dev project. Remove/condense: Section 1 Cultural Shifts, Phase 3 pentest/bug bounty, Phase 4 ISO 27001, Security Maturity Model 5-level diagram. Target: ~300-400 lines keeping architecture docs, Phase 0-1, risk register","status":"closed","priority":2,"issue_type":"chore","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T16:45:31Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T16:55:10Z","closed_at":"2026-02-22T16:55:10Z","close_reason":"Trimmed roadmap from 873 to 406 lines: removed enterprise sections, condensed phases 3-4, replaced maturity model with status table"}
{"id":"buh-nyt","title":"Фронтенд: polling, telegramDate, edit indicator, message types","description":"Файл: frontend/src/components/chats/ChatMessageThread.tsx. 1) Polling: refetchInterval: 10000, refetchIntervalInBackground: false. 2) telegramDate вместо createdAt в formatTime/formatDate. 3) Индикатор (ред.) при editVersion \u003e 0. 4) Иконки для message types (document, photo, sticker). Зависит от расширения tRPC output schema.","status":"closed","priority":1,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T15:04:53Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T15:20:01Z","closed_at":"2026-02-22T15:20:01Z","close_reason":"Реализовано и верифицировано: все type-check проходят","dependencies":[{"issue_id":"buh-nyt","depends_on_id":"buh-bnr","type":"blocks","created_at":"2026-02-22T18:05:01Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-oiv","title":"Add /diagnose command for runtime chat diagnostics","description":"Add /diagnose command to system.handler.ts that checks: 1) Privacy Mode via getMe(), 2) Bot member status via getChatMember, 3) Chat registration in DB, 4) Message count in last 24h, 5) Verdict with recommendation. Register in webhook.ts commands and add to help text.","status":"closed","priority":1,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-24T16:41:24Z","created_by":"Igor Maslennikov","updated_at":"2026-02-24T16:50:18Z","closed_at":"2026-02-24T16:50:18Z","close_reason":"Implemented and verified"}
{"id":"buh-oj5","title":"L-1: Clarify isDevModeLocal comment in supabase.ts","description":"Code review finding L-1. frontend/src/lib/supabase.ts:9-10 comment is misleading after refactor. Fix: update comment to clarify it's only for console.warn, not auth bypass.","status":"closed","priority":3,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:40:11Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:41:10Z","closed_at":"2026-02-20T16:41:10Z","close_reason":"Closed"}
{"id":"buh-pm6","title":"Code review fixes: append-only message store","description":"Исправления по результатам код-ревью PR#197 (buh-kwi). 2 P0, 5 P1, 7 P2, 5 P3 findings.","status":"closed","priority":1,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T17:18:03Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T17:33:28Z","closed_at":"2026-02-22T17:33:28Z","close_reason":"All code review findings addressed"}
{"id":"buh-pnm","title":"gh-178: Add SSR production warning for missing API URL","description":"When NEXT_PUBLIC_API_URL is missing, SSR falls back to localhost which fails in Docker. Fix: add console.warn in trpc.ts getBaseUrl() when NODE_ENV=production and no NEXT_PUBLIC_API_URL. File: frontend/src/lib/trpc.ts:30-43","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:19:56Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:23:30Z","closed_at":"2026-02-20T16:23:30Z","close_reason":"Closed","external_ref":"gh-178"}
{"id":"buh-pw4","title":"Add CSP headers to Nginx config","description":"Both security assessments correctly note missing Content-Security-Policy headers. Add CSP header to infrastructure/nginx/nginx.conf near existing security headers (lines 144-148). Needs staging testing.","status":"closed","priority":3,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T16:45:32Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T11:06:01Z","closed_at":"2026-02-26T11:06:01Z","close_reason":"Implemented in commit 142461b on chore/misc-improvements"}
{"id":"buh-ryc","title":"L-3: Warn when FRONTEND_URL uses default in production","description":"backend/src/config/env.ts:102 FRONTEND_URL silently defaults to staging domain. Fix: add runtime warning in index.ts when production uses default value.","status":"closed","priority":3,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:45:45Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:46:44Z","closed_at":"2026-02-20T16:46:44Z","close_reason":"Closed"}
{"id":"buh-ti4","title":"Switch default OpenRouter model to xiaomi/mimo-v2-flash","description":"Replace openai/gpt-oss-120b with xiaomi/mimo-v2-flash as default classifier model in types.ts, config.service.ts, schema.prisma + DB migration","status":"closed","priority":2,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-21T12:44:22Z","created_by":"Igor Maslennikov","updated_at":"2026-02-21T12:47:02Z","closed_at":"2026-02-21T12:47:02Z","close_reason":"Changed default model in types.ts, config.service.ts, schema.prisma + migration"}
{"id":"buh-tti","title":"CR-11/15: frontend InvitationModal fixes","description":"P2: fix copyToClipboard state bug, fix Tab 2 description text","status":"closed","priority":2,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-24T18:43:39Z","created_by":"Igor Maslennikov","updated_at":"2026-02-24T18:52:16Z","closed_at":"2026-02-24T18:52:16Z","close_reason":"All CR findings fixed in commit 62e4a4b"}
{"id":"buh-vqy","title":"gh-174: Document DEV_MODE as local-only","description":"DEV_MODE env vars not in Docker builds. Decision: document as local-only (pnpm dev). Fix: update comment in frontend/.env.example line 19","status":"closed","priority":3,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:20:01Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:23:30Z","closed_at":"2026-02-20T16:23:30Z","close_reason":"Closed","external_ref":"gh-174"}
{"id":"buh-vsw","title":"P0-1: Document append-only exception in response.handler","description":"updateMany мутирует ChatMessage (resolvedRequestId). Это единственное исключение из append-only. Добавить явные комментарии в schema.prisma и response.handler.ts документирующие это как допустимое исключение.","status":"closed","priority":0,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T17:18:19Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T17:20:49Z","closed_at":"2026-02-22T17:20:49Z","close_reason":"Documented append-only exception in schema.prisma and response.handler.ts","dependencies":[{"issue_id":"buh-vsw","depends_on_id":"buh-pm6","type":"blocks","created_at":"2026-02-22T20:18:37Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-w26","title":"Обновить chat-event.handler.ts для triple-unique при миграции групп","description":"Файл: backend/src/bot/handlers/chat-event.handler.ts:229-241. Обработка конфликтов при миграции группы -\u003e супергруппы с учётом нового composite unique (chatId, messageId, editVersion).","status":"closed","priority":1,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T15:04:51Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T15:08:56Z","closed_at":"2026-02-22T15:08:56Z","close_reason":"Код обновлён: append-only insert, editVersion filter, triple-unique migration","dependencies":[{"issue_id":"buh-w26","depends_on_id":"buh-7dm","type":"blocks","created_at":"2026-02-22T18:05:00Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-w39","title":"Создать edit.handler.ts + регистрация в bot/index.ts","description":"Новый файл: backend/src/bot/handlers/edit.handler.ts. Хэндлер bot.on('edited_message'). Найти MAX(editVersion) для (chatId, messageId), вставить новую запись с editVersion+1 и текстом из ctx.editedMessage.text. skipDuplicates. Регистрация в backend/src/bot/index.ts после response handler.","status":"closed","priority":1,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-22T15:04:52Z","created_by":"Igor Maslennikov","updated_at":"2026-02-22T15:20:01Z","closed_at":"2026-02-22T15:20:01Z","close_reason":"Реализовано и верифицировано: все type-check проходят","dependencies":[{"issue_id":"buh-w39","depends_on_id":"buh-7dm","type":"blocks","created_at":"2026-02-22T18:05:00Z","created_by":"Igor Maslennikov","metadata":"{}"}]}
{"id":"buh-x64","title":"gh-208: Chat Window Scroll Behavior Options","description":"gh-208: Chat scroll behavior. Auto-scroll to bottom on initial load and new messages. Floating 'jump to latest' button with new message count badge. Uses isAtBottom state, prevMessageCountRef, requestAnimationFrame for smooth scroll. Frontend only, ChatMessageThread.tsx. Implemented by subagent, verified.","status":"closed","priority":3,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-26T10:04:02Z","created_by":"Igor Maslennikov","updated_at":"2026-02-26T11:06:01Z","closed_at":"2026-02-26T11:06:01Z","close_reason":"Implemented in commit 142461b on chore/misc-improvements","external_ref":"gh-208"}
{"id":"buh-xn0","title":"L-4: Remove || true from CI security scan","description":"ci.yml:226 security scan has double-silencing (|| true + continue-on-error). Fix: remove || true, tighten to --audit-level=critical, keep continue-on-error for visibility.","status":"closed","priority":3,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:45:47Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:46:44Z","closed_at":"2026-02-20T16:46:44Z","close_reason":"Closed"}
{"id":"buh-ytn","title":"gh-179: Add DEV_MODE startup warning in backend","description":"DEV_MODE bypasses auth but only logs at DEBUG level. Fix: add WARN-level startup log in backend/src/index.ts when isDevMode is active. Import isDevMode from config/env.js, add warning at start of startServer()","status":"closed","priority":2,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:19:57Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:23:30Z","closed_at":"2026-02-20T16:23:30Z","close_reason":"Closed","external_ref":"gh-179"}
{"id":"buh-z3p","title":"M-1: Update docker-compose comment for all build args","description":"Code review finding M-1. infrastructure/docker-compose.yml:59 comment lists only 2 of 4 build args. Fix: update comment to include all four.","status":"closed","priority":3,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T16:40:10Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T16:41:10Z","closed_at":"2026-02-20T16:41:10Z","close_reason":"Closed"}
{"id":"buh-z5d","title":"RC1: Move monitoringEnabled check after ChatMessage upsert","description":"message.handler.ts:126-131 — monitoringEnabled gate exits BEFORE ChatMessage logging at line 161. Move the check AFTER the upsert so messages are always logged. monitoringEnabled should only gate SLA classification/timer logic. File: backend/src/bot/handlers/message.handler.ts. Ref: gh-185","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-02-20T19:35:47Z","created_by":"Igor Maslennikov","updated_at":"2026-02-20T19:43:07Z","closed_at":"2026-02-20T19:43:07Z","close_reason":"monitoringEnabled check moved after ChatMessage upsert in message.handler.ts"}

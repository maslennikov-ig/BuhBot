# Руководство по тестированию BuhBot v0.8.3

## Введение

Этот документ описывает полный процесс тестирования системы BuhBot — платформы автоматизации коммуникаций для бухгалтерских фирм. Система отслеживает время ответа на сообщения клиентов (SLA) и уведомляет менеджеров о нарушениях.

---

## Статус исправлений

### 11 декабря 2025 (последнее обновление)

> **ИСПРАВЛЕНО:** Команда `/menu` не отвечала пользователям.
>
> **Что было исправлено:**
> - Порядок регистрации обработчиков команд (menu, template теперь обрабатываются корректно)
> - Конфигурация `BOT_USERNAME` для генерации правильных deep-ссылок
>
> **Все 4 команды бота теперь работают: /start, /menu, /help, /connect**

### 10 декабря 2025

> **ИСПРАВЛЕНО:** Бот был полностью неактивен из-за технической ошибки в конфигурации сервера.
>
> **Что было исправлено:**
> - Инициализация Telegram бота при запуске сервера
> - Webhook URL исправлен на HTTPS
> - Добавлены недостающие типы данных в базу

---

## Доступ к системе

| Параметр | Значение |
|----------|----------|
| URL | https://buhbot.aidevteam.ru/ |
| Telegram бот | @top_buhbot |

---

## Подготовка к тестированию

### Что понадобится:
1. Компьютер с браузером (Chrome, Firefox, Safari, Edge)
2. Telegram аккаунт (желательно два: "менеджер" и "клиент")
3. Доступ к админ-панели по ссылке выше

### Рекомендации:
- Тестируйте в режиме инкогнито для чистой сессии
- Проверяйте работу на разных устройствах (десктоп, мобильный)
- Тестируйте обе темы (светлая и тёмная)

---

## Быстрый тест бота

Прежде чем начать полное тестирование, убедитесь что бот работает:

1. Откройте Telegram
2. Найдите бота `@top_buhbot`
3. Отправьте команду `/start`
4. **Ожидаемый результат:** Бот отвечает приветственным сообщением

**Проверьте все команды:**
| Команда | Ожидаемый результат |
|---------|---------------------|
| `/start` | Приветственное сообщение |
| `/menu` | Меню с кнопками (Статус документов, Связаться с бухгалтером, Запросить услугу) |
| `/help` | Справка по боту |
| `/connect КОД` | Сообщение об ошибке (без кода) или подключение (с валидным кодом) |

Если все команды работают — можно продолжать тестирование!

---

## Сценарии тестирования

### Сценарий 1: Авторизация и первый вход

**Шаги:**
1. Откройте https://buhbot.aidevteam.ru/
2. Нажмите "Войти" на лендинге
3. Введите тестовые учётные данные
4. Подтвердите вход

**Ожидаемый результат:**
- Успешный вход в систему
- Редирект на Dashboard
- Отображение меню слева: Дашборд, Чаты, Заявки, Аналитика, Алерты, SLA, Настройки

**Проверьте также:**
- [x] Переключение темы (иконка солнце/луна в шапке)
- [x] Логотип отображается корректно в обеих темах
- [x] Боковое меню сворачивается/разворачивается

**Статус: ВЫПОЛНЕНО**

---

### Сценарий 2: Подключение чатов

Это ключевой функционал. Есть 4 способа подключения чатов:

#### Способ А: Автоматическое подключение группы

1. Создайте группу в Telegram или используйте существующую
2. Добавьте бота `@top_buhbot` в группу
3. Бот автоматически зарегистрирует чат в системе
4. Перейдите в админку → **Чаты**
5. Чат должен появиться автоматически с названием группы
6. Нажмите "Настройки" → включите "SLA Мониторинг" → "Сохранить"

**Ожидаемый результат:** Чат появляется в списке в течение 5-10 секунд

**Примечание:** По умолчанию SLA-мониторинг выключен для автоматически добавленных чатов — это сделано намеренно для безопасности.

---

#### Способ Б: Ссылка-приглашение (для личных чатов)

1. Перейдите в **Чаты** → нажмите **"Подключить чат"**
2. Выберите вкладку **"Ссылка"**
3. (Опционально) Выберите ответственного бухгалтера
4. (Опционально) Введите название чата
5. Нажмите **"Сгенерировать ссылку"**
6. Скопируйте сгенерированную ссылку (кнопка копирования справа)
7. Отправьте ссылку клиенту
8. Клиент переходит по ссылке → нажимает "Start" в боте

**Ожидаемый результат:**
- Ссылка имеет формат: `https://t.me/top_buhbot?start=ТОКЕН`
- Бот отвечает: "✅ Чат успешно подключен!"
- Чат появляется в списке админки с указанным бухгалтером

**Проверьте:**
- [ ] Кнопка копирования показывает галочку после копирования
- [ ] Toast уведомление "Скопировано"
- [ ] Ссылка ведёт именно на @top_buhbot (не на другого бота!)
- [ ] Бот отвечает на /start с токеном

---

#### Способ В: Код подключения (для групп)

1. Перейдите в **Чаты** → **"Подключить чат"**
2. Выберите вкладку **"Код"**
3. Нажмите **"Сгенерировать код"**
4. Скопируйте команду `/connect XXXXX`
5. Добавьте бота `@top_buhbot` в группу (если ещё не добавлен)
6. Вставьте команду в группу

**Ожидаемый результат:**
- Бот отвечает: "✅ Чат успешно подключен!"
- Группа появляется в списке чатов

---

#### Способ Г: Ручной ввод (Legacy)

1. Перейдите в **Чаты** → **"Подключить чат"**
2. Выберите вкладку **"Вручную"**
3. Введите Telegram Chat ID (например, `-1001234567890`)
4. Выберите тип чата (Личный/Группа/Супергруппа)
5. Нажмите "Добавить"

**Как узнать Chat ID:**
- Добавьте в чат бота `@getmyid_bot`
- Он пришлёт ID чата

---

### Сценарий 3: Проверка SLA-мониторинга

> **Примечание:** Этот сценарий можно тестировать только после успешного подключения чата (Сценарий 2) и включения SLA-мониторинга в настройках чата.

**Тест 1: Обнаружение нового сообщения**
1. Напишите сообщение в подключённый чат от лица клиента
2. Перейдите в админку → **Заявки**
3. Сообщение должно появиться со статусом "Ожидает"

**Тест 2: Успешный ответ (Good Path)**
1. Напишите сообщение от клиента
2. В течение SLA-порога (по умолчанию 60 мин) ответьте от лица бухгалтера
3. Заявка должна закрыться со статусом "Выполнено"

**Тест 3: Нарушение SLA (Bad Path)**
1. Напишите сообщение от клиента
2. НЕ отвечайте на него
3. Дождитесь истечения SLA-порога
4. В разделе **Алерты** должно появиться уведомление о нарушении
5. На **Дашборде** счётчик нарушений должен увеличиться

---

### Сценарий 4: Настройка чата

1. Перейдите в **Чаты** → выберите чат → **Настройки**
2. Проверьте возможность изменения:
   - [ ] Название чата
   - [ ] Ответственный бухгалтер
   - [ ] SLA мониторинг (вкл/выкл)
   - [ ] Порог SLA (минуты)
   - [ ] Режим 24/7
3. Сохраните изменения
4. Обновите страницу — настройки должны сохраниться

---

### Сценарий 5: Управление пользователями

1. Перейдите в **Настройки** → **Пользователи**
2. Нажмите **"Добавить пользователя"**
3. Заполните:
   - Email
   - Полное имя
   - Роль (Администратор / Менеджер / Наблюдатель)
4. Нажмите "Создать"

**Ожидаемый результат:**
- Пользователь создан
- На указанный email отправлено приглашение
- Toast: "Приглашение отправлено на email@example.com"

**Проверьте роли:**
| Роль | Доступ |
|------|--------|
| Администратор | Полный доступ, управление пользователями |
| Менеджер | Чаты, заявки, аналитика (без управления пользователями) |
| Наблюдатель | Только просмотр статистики |

---

### Сценарий 6: Аналитика и отчёты

1. Перейдите в **Аналитика**
2. Проверьте отображение:
   - [ ] График времени ответа
   - [ ] Статистика по чатам
   - [ ] Рейтинг бухгалтеров
3. Попробуйте изменить период (день/неделя/месяц)

---

### Сценарий 7: Привязка Telegram

1. Перейдите в **Настройки** → **Профиль**
2. Нажмите **"Привязать Telegram"**
3. Авторизуйтесь через Telegram Login Widget
4. Проверьте, что аккаунт привязан

**Зачем нужно:** Для получения алертов о нарушениях напрямую в Telegram

---

### Сценарий 8: Проверка адаптивности

Проверьте работу интерфейса на разных устройствах:

| Устройство | Что проверить |
|------------|---------------|
| Desktop (1920x1080) | Полный интерфейс, боковое меню развёрнуто |
| Laptop (1366x768) | Боковое меню сворачивается |
| Tablet (768x1024) | Мобильное меню-бургер |
| Mobile (375x667) | Все элементы доступны, нет горизонтального скролла |

---

### Сценарий 9: Проверка тем

1. Нажмите на иконку темы в шапке (солнце/луна)
2. Переключитесь между светлой и тёмной темой
3. Проверьте:
   - [ ] Все тексты читаемы
   - [ ] Контраст достаточный
   - [ ] Логотип корректно меняется
   - [ ] Графики и иконки видны
   - [ ] Модальные окна корректно отображаются

---

## Чек-лист критических функций

| # | Функция | Статус |
|---|---------|--------|
| 1 | Авторизация работает | [x] Выполнено |
| 2 | Бот отвечает на /start | [ ] |
| 3 | Бот отвечает на /menu | [ ] |
| 4 | Бот отвечает на /help | [ ] |
| 5 | Бот отвечает на /connect | [ ] |
| 6 | Подключение чата через ссылку | [ ] |
| 7 | Подключение чата через код | [ ] |
| 8 | Автоподключение группы | [ ] |
| 9 | Обнаружение сообщений | [ ] |
| 10 | Закрытие заявки при ответе | [ ] |
| 11 | Алерт при нарушении SLA | [ ] |
| 12 | Создание пользователей | [ ] |
| 13 | Смена темы | [x] Выполнено |
| 14 | Копирование ссылки/кода | [ ] |

---

## Отчёт об ошибках

При обнаружении ошибки сообщите:

### 1. Описание
> "Нажимаю кнопку 'Сгенерировать ссылку', но ничего не происходит"

### 2. Шаги воспроизведения
1. Перейти в Чаты
2. Нажать "Подключить чат"
3. Выбрать вкладку "Ссылка"
4. Нажать "Сгенерировать ссылку"

### 3. Ожидаемый результат
Появляется ссылка для копирования

### 4. Фактический результат
Кнопка крутится бесконечно

### 5. Скриншот
(Приложите скриншот экрана)

### 6. Консоль браузера (F12 → Console)
Скопируйте красный текст ошибки, если есть

### 7. Окружение
- Браузер: Chrome 120
- ОС: Windows 11
- Устройство: Desktop
- Тема: Тёмная

---

## Контакты

- GitHub Issues: https://github.com/maslennikov-ig/BuhBot/issues

---

**Спасибо за тестирование! Ваша обратная связь делает продукт лучше.**

{"id":"buh-3fb","title":"P1: Fix recovery logic to use global manager fallback","description":"timer.service.ts:681-689 - Recovery uses getManagersForChat() without global fallback. Add fallback to global managers.","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-14T16:13:18.349454368+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-14T16:15:17.840912472+03:00","closed_at":"2026-01-14T16:15:17.840912472+03:00","close_reason":"Fixed: race condition, recovery fallback, logging, Redis policy"}
{"id":"buh-4ru","title":"P2: Add transaction boundaries for SLA breach handling","description":"sla-timer.worker.ts:77-101 - Multiple DB updates without transaction. Use prisma.$transaction for atomic operations.","status":"closed","priority":2,"issue_type":"chore","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-14T16:13:19.746350333+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-14T16:17:39.835558086+03:00","closed_at":"2026-01-14T16:17:39.835558086+03:00","close_reason":"Fixed: UI warning, transaction boundaries, manager validation"}
{"id":"buh-65g","title":"Phase 2: Implement ErrorCaptureService with fingerprinting","description":"Create error-capture.service.ts with fingerprinting logic (MD5 hash normalization). Add DatabaseTransport to Winston logger for automatic error capture to DB.","status":"closed","priority":2,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-16T13:57:39.030251238+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-16T14:15:27.642114722+03:00","closed_at":"2026-01-16T14:15:27.642114722+03:00","close_reason":"ErrorCaptureService implemented with MD5 fingerprinting, normalization (UUIDs, timestamps, numbers), 24h deduplication window, Winston DatabaseTransport integration complete, type-check passed"}
{"id":"buh-6m0","title":"Fix SLA Timer ignores GlobalSettings working hours","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-30T13:04:12.052978806+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-30T13:09:12.751451128+03:00","closed_at":"2026-01-30T13:09:12.751451128+03:00","close_reason":"Fixed all bugs, type-check and build passed"}
{"id":"buh-78q","title":"Add logging when no managers configured for alerts","description":"В backend/src/queues/alert.worker.ts добавить logger.warn когда managerIds.length === 0","status":"closed","priority":3,"issue_type":"chore","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-14T16:05:44.706863307+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-14T16:15:17.847639593+03:00","closed_at":"2026-01-14T16:15:17.847639593+03:00","close_reason":"Fixed: race condition, recovery fallback, logging, Redis policy"}
{"id":"buh-7ly","title":"Fix alert shows 0 minutes instead of actual time","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-30T13:04:07.407544902+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-30T13:05:11.112542925+03:00","closed_at":"2026-01-30T13:05:11.112542925+03:00","close_reason":"Fixed: use slaAlerts[0].minutesElapsed instead of slaWorkingMinutes"}
{"id":"buh-8tp","title":"Add invite_link to Chat model and fetch on registration","description":"## Context\n- Chat model has no inviteLink field\n- t.me/c/ links only work for supergroups, not regular groups\n- Need to store invite_link in DB and use it for 'Open chat' button\n\n## Requirements\n1. Add inviteLink field to Chat model (prisma schema)\n2. Create migration\n3. On chat registration (/connect), fetch invite link via Telegram API:\n   - ctx.telegram.exportChatInviteLink(chatId) or createChatInviteLink\n4. Store invite_link in Chat record\n5. Update alert.keyboard.ts to use inviteLink if available, fallback to t.me/c/ for supergroups\n\n## Files to modify\n- backend/prisma/schema.prisma (add inviteLink String?)\n- backend/src/bot/handlers/invitation.handler.ts (fetch and store invite link)\n- backend/src/bot/keyboards/alert.keyboard.ts (use inviteLink in buildAlertKeyboard)\n\n## Telegram API\n- ctx.telegram.exportChatInviteLink(chatId) - returns primary invite link\n- ctx.telegram.createChatInviteLink(chatId) - creates new invite link","status":"closed","priority":1,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-14T16:40:41.02058533+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-14T16:49:01.6098149+03:00","closed_at":"2026-01-14T16:49:01.6098149+03:00","close_reason":"Implemented and deployed"}
{"id":"buh-brr","title":"Phase 5: Create frontend logs components (Table, Header, Filters, StatusBadge)","description":"Create LogsTable.tsx, LogsHeader.tsx, LogsFilters.tsx, StatusBadge.tsx components. Follow existing patterns from RequestsTable.tsx.","status":"closed","priority":2,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-16T13:57:44.188449266+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-16T14:29:56.44419224+03:00","closed_at":"2026-01-16T14:29:56.44419224+03:00","close_reason":"Frontend logs UI complete: 6 files created (4 components + 2 pages), type-check passed, follows BuhBot design patterns, integrated with tRPC router"}
{"id":"buh-chq","title":"HOTFIX: Configure SLA settings - set manager_telegram_ids and sla_threshold=15","description":"Root cause: manager_telegram_ids was empty [], sla_threshold was 60 instead of 15. Fixed via SQL: UPDATE global_settings SET global_manager_ids=['166848328'], default_sla_threshold=15; UPDATE chats SET sla_threshold_minutes=15, manager_telegram_ids=['166848328'] WHERE sla_enabled=true","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-14T15:59:40.995281559+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-14T15:59:47.159179014+03:00","closed_at":"2026-01-14T15:59:47.159179014+03:00","close_reason":"Fixed: Updated global_settings and all 4 chats with sla_enabled=true. SLA threshold set to 15 min, manager_telegram_ids set to [166848328]"}
{"id":"buh-dex","title":"P1: Validate manager lists before alert creation","description":"alert.service.ts:133-164 - Alert created BEFORE checking for managers. Move validation before creation, add global fallback.","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-14T16:13:17.240767346+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-14T16:17:39.850309561+03:00","closed_at":"2026-01-14T16:17:39.850309561+03:00","close_reason":"Fixed: UI warning, transaction boundaries, manager validation"}
{"id":"buh-gma","title":"Code review: SLA/alert system","description":"Провести код-ревью SLA/alert системы: alert.worker.ts, sla-timer.worker.ts, message.handler.ts. Проверить на баги, best practices, улучшения.","status":"closed","priority":2,"issue_type":"chore","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-14T16:07:58.777748986+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-14T16:17:39.857514217+03:00","closed_at":"2026-01-14T16:17:39.857514217+03:00","close_reason":"Fixed: UI warning, transaction boundaries, manager validation"}
{"id":"buh-gn4","title":"Fix ClassifierService ignores aiConfidenceThreshold","status":"closed","priority":2,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-30T13:04:13.261336077+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-30T13:09:12.75916173+03:00","closed_at":"2026-01-30T13:09:12.75916173+03:00","close_reason":"Fixed all bugs, type-check and build passed"}
{"id":"buh-hzd","title":"P0: Fix race condition in alert delivery status updates","description":"alert.worker.ts:203-223 - Two separate DB updates for same alert. If crash between updates, alert stuck in 'sent' state. Fix: collect all message IDs, single atomic update at end.","status":"closed","priority":0,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-14T16:13:15.093742536+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-14T16:15:17.833742308+03:00","closed_at":"2026-01-14T16:15:17.833742308+03:00","close_reason":"Fixed: race condition, recovery fallback, logging, Redis policy"}
{"id":"buh-jo3","title":"Add warning in UI when manager_telegram_ids is empty","description":"UI позволяет сохранять чат без manager_telegram_ids, что делает уведомления невозможными. Добавить warning в frontend/src/app/chats/[id]/page.tsx","status":"closed","priority":2,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-14T16:05:43.671455481+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-14T16:17:39.827969707+03:00","closed_at":"2026-01-14T16:17:39.827969707+03:00","close_reason":"Fixed: UI warning, transaction boundaries, manager validation"}
{"id":"buh-k5a","title":"Notify all accountants from accountantUsernames array","description":"## Context\n- Currently only assignedAccountant receives DM notification\n- accountantUsernames array may contain multiple accountants\n- Need to notify ALL accountants, not just the assigned one\n\n## Requirements\n1. In alert-callback.handler.ts, collect all accountant telegram_ids:\n   - assignedAccountant.telegramId (primary)\n   - For each username in accountantUsernames, lookup in users table by telegramUsername\n2. Send notification to ALL found telegram_ids (not just one)\n3. Fallback to group mention if no telegram_ids found\n\n## Files to modify\n- backend/src/bot/handlers/alert-callback.handler.ts\n\n## DB Query needed\nSELECT telegram_id FROM users WHERE telegram_username IN (accountantUsernames)\n\n## Edge cases\n- Duplicate: assignedAccountant might also be in accountantUsernames - dedupe\n- Not found: username in array but no matching user - skip silently\n- All fail: fallback to group mention","status":"closed","priority":1,"issue_type":"feature","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-14T16:40:42.051395191+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-14T16:49:01.615871195+03:00","closed_at":"2026-01-14T16:49:01.615871195+03:00","close_reason":"Implemented and deployed"}
{"id":"buh-l8q","title":"Fix BigInt serialization in logger","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-30T13:04:05.524518456+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-30T13:04:56.454490145+03:00","closed_at":"2026-01-30T13:04:56.454490145+03:00","close_reason":"Fixed BigInt serialization in logger"}
{"id":"buh-mgs","title":"Phase 4: Create frontend logs pages (main + detail)","description":"Create /logs/page.tsx (main list page) and /logs/[id]/page.tsx (detail page). Use AdminLayout, tRPC queries, and table components.","status":"closed","priority":2,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-16T13:57:42.628678792+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-16T14:29:56.438322317+03:00","closed_at":"2026-01-16T14:29:56.438322317+03:00","close_reason":"Frontend logs UI complete: 6 files created (4 components + 2 pages), type-check passed, follows BuhBot design patterns, integrated with tRPC router"}
{"id":"buh-mym","title":"Fix hardcoded min(15) in SLA validation","status":"closed","priority":2,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-30T13:04:14.308506073+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-30T13:09:12.767044082+03:00","closed_at":"2026-01-30T13:09:12.767044082+03:00","close_reason":"Fixed all bugs, type-check and build passed"}
{"id":"buh-oyj","title":"Phase 1: Add ErrorLog Prisma model and migration","description":"Add ErrorLog model with ErrorStatus enum to Prisma schema. Include RLS policies for admin-only access. Generate and apply migration.","status":"closed","priority":2,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-16T13:57:36.343649533+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-16T14:04:24.438053488+03:00","closed_at":"2026-01-16T14:04:24.438053488+03:00","close_reason":"ErrorLog Prisma model added with ErrorStatus enum, migration 20260116000000_add_error_logs created and applied, RLS policies implemented, User model updated with assignedErrors relation"}
{"id":"buh-qgo","title":"Fix Redis eviction policy for BullMQ","description":"Redis настроен с allkeys-lru, должен быть noeviction для BullMQ. Файл: infrastructure/docker-compose.yml","status":"closed","priority":3,"issue_type":"chore","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-14T16:05:45.830142822+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-14T16:15:17.854116079+03:00","closed_at":"2026-01-14T16:15:17.854116079+03:00","close_reason":"Fixed: race condition, recovery fallback, logging, Redis policy"}
{"id":"buh-vn3","title":"Test Beads integration","description":"Test task to verify Beads is working correctly","status":"closed","priority":4,"issue_type":"chore","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-14T13:40:24.325176345+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-14T13:40:32.649950416+03:00","closed_at":"2026-01-14T13:40:32.649950416+03:00","close_reason":"Test completed - Beads integration verified"}
{"id":"buh-w1w","title":"P1: Add global manager fallback when chat managers empty","description":"sla-timer.worker.ts:122-143 - When no managers configured, system logs warning but takes no action. Add fallback to global_settings.globalManagerIds","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-14T16:13:16.252217505+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-14T16:17:39.843444149+03:00","closed_at":"2026-01-14T16:17:39.843444149+03:00","close_reason":"Fixed: UI warning, transaction boundaries, manager validation"}
{"id":"buh-xch","title":"P2: Centralize queue configuration in environment variables","description":"Hardcoded values in alert.worker.ts, sla-timer.worker.ts, setup.ts. Create config/queue.config.ts with env vars.","status":"open","priority":2,"issue_type":"chore","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-14T16:13:20.880993331+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-14T16:13:20.880993331+03:00"}
{"id":"buh-xla","title":"Phase 6: Add logs navigation item to AdminLayout","description":"Add 'System Logs' navigation item to AdminLayout.tsx navigation items array.","status":"closed","priority":2,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-16T13:57:46.196945383+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-16T14:32:05.553175641+03:00","closed_at":"2026-01-16T14:32:05.553175641+03:00","close_reason":"Navigation item added to AdminLayout: 'Системные логи' with FileWarning icon, placed between Users and Settings"}
{"id":"buh-zdc","title":"Phase 3: Create tRPC logs router with all procedures","description":"Create logs.ts router with procedures: list, listGrouped, getById, updateStatus, bulkUpdateStatus, delete. Register in appRouter.","status":"closed","priority":2,"issue_type":"task","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-16T13:57:40.588733612+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-16T14:20:45.825923039+03:00","closed_at":"2026-01-16T14:20:45.825923039+03:00","close_reason":"tRPC logs router implemented with 6 procedures: list (cursor pagination), listGrouped (fingerprint grouping), getById, updateStatus, bulkUpdateStatus, delete. All admin-guarded mutations, type-check passed"}
{"id":"buh-zi0","title":"Fix new chat ignores defaultSlaThreshold","status":"closed","priority":1,"issue_type":"bug","owner":"maslennikov.ig@gmail.com","created_at":"2026-01-30T13:04:08.313784117+03:00","created_by":"Igor Maslennikov","updated_at":"2026-01-30T13:09:12.744294903+03:00","closed_at":"2026-01-30T13:09:12.744294903+03:00","close_reason":"Fixed all bugs, type-check and build passed"}

# ADR-002: Release Please as Primary Release Automation

## Status

Accepted

## Date

2026-02-03

## Context

The project needs consistent, merge-based releases and CHANGELOG generation from conventional commits. Today:

- [.claude/scripts/release.sh](.claude/scripts/release.sh) is run manually (via `/push patch|minor|major`) to bump versions, update CHANGELOG.md and RELEASE_NOTES.md, and create tags.
- There is no review step for release content; the script runs locally and pushes directly.
- It is easy to forget to run a release, run it with the wrong bump type, or have CHANGELOG drift from actual commits.

We already enforce conventional commits (commitlint) and document Release Please–friendly rules in [docs/COMMIT_CONVENTIONS.md](docs/COMMIT_CONVENTIONS.md). Adopting a tool that consumes those commits for releases would align automation with existing practice.

## Decision

Adopt **Release Please** as the primary release automation:

- **GitHub Action** runs on push to `main` and reads [release-please-config.json](release-please-config.json) and [.release-please-manifest.json](.release-please-manifest.json) at repo root.
- **Release PR:** The action opens or updates a release PR that updates CHANGELOG.md and version(s). Merging that PR creates the git tag and GitHub release.
- **Legacy script:** [.claude/scripts/release.sh](.claude/scripts/release.sh) and the `/push` command remain available for optional use (e.g. RELEASE_NOTES.md generation or local tagging). They are no longer the primary path for product releases.

### Configuration

- **Workflow:** [.github/workflows/release-please.yml](.github/workflows/release-please.yml) — triggers on `workflow_run` after CI completes (not direct `push` to `main`), `googleapis/release-please-action@v4`, permissions `contents: write`, `pull-requests: write`, `actions: read`.
- **Config:** `release-type: node`, `changelog-path: CHANGELOG.md`, single package `"."`.
- **Manifest:** `.release-please-manifest.json` with current version; Release Please updates it and root package.json.

## Alternatives Considered

### Alternative 1: Status quo (release.sh only)

Keep the existing [.claude/scripts/release.sh](.claude/scripts/release.sh) as the only release path.

**Pros:**

- Already in use; no new tooling or workflow.
- Full control over CHANGELOG and RELEASE_NOTES format.
- Single script for both version bump and changelog.

**Cons:**

- Manual step; easy to forget or run with wrong bump.
- No PR review for release content before tag/release.
- Pushing tags directly from local can conflict with CI or other automation.

### Alternative 2: semantic-release

Use [semantic-release](https://github.com/semantic-release/semantic-release) to compute version and publish from conventional commits.

**Pros:**

- Single tool; widely used; can publish to npm.
- Can run in CI on merge to main and create tag + release without a release PR.

**Cons:**

- Different model: typically no release PR by default; tag/release created on merge. Less visibility into “what will be released” before merge.
- More configuration (plugins, branches). May be overkill if we do not publish to npm.
- Would require replacing or significantly changing the current release script.

### Alternative 3: Release Please

Use [Release Please](https://github.com/googleapis/release-please) (GitHub Action + config).

**Pros:**

- **Release PR:** Reviewable PR that updates CHANGELOG and version; merge = tag + GitHub release. Clear audit trail.
- **Conventional-commits driven:** Aligns with existing commitlint and [docs/COMMIT_CONVENTIONS.md](docs/COMMIT_CONVENTIONS.md).
- **No npm install:** Runs as a GitHub Action; only config files in repo.
- **Low operational overhead:** Action runs on push to main; no manual trigger for normal releases.

**Cons:**

- Depends on GitHub Action and merge discipline (conventional commits on main).
- RELEASE_NOTES.md (user-facing) is not generated by Release Please; we keep the option to run the legacy script for that or other one-offs.

## Rationale

- Aligns with existing conventional commits and commit conventions; no change to how developers write commits.
- Provides a clear, reviewable release PR so “what’s in the release” is visible before the tag is created.
- Reduces manual steps and human error (wrong bump, forgotten release).
- Keeps the legacy script for optional RELEASE_NOTES or local use without blocking adoption.

## Consequences

### Positive

- CHANGELOG and version bumps are driven by merges to `main`; no manual `/push` required for normal releases.
- Release content is reviewable in a PR before the tag is created.
- Single source of truth for “next version” and changelog (Release Please PR).

### Negative

- Contributors and agents must follow [docs/COMMIT_CONVENTIONS.md](docs/COMMIT_CONVENTIONS.md) so Release Please parses commits correctly; non-conventional commits may be omitted or misclassified.
- RELEASE_NOTES.md is not updated by Release Please; we rely on the legacy script or manual edits if we want to keep that file.

### Mitigation

- Documentation and agent instructions (CLAUDE.md, push.md, skills) updated to state that Release Please is the primary release automation and that `/push` is optional.
- Commit conventions and commitlint already enforce the format Release Please expects.

## References

- [Release Please](https://github.com/googleapis/release-please)
- [Release Please Action](https://github.com/googleapis/release-please-action)
- [Commit Conventions](docs/COMMIT_CONVENTIONS.md)
- [Release Process](docs/infrastructure/release-process.md)
